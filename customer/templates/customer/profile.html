{% extends "base.html" %}
{% load static %}
{% load django_bootstrap5 %}

{% bootstrap_messages %}

{% block content %}
<!--Header-->
<div class="container">

  {% if messages %}
  {% for message in messages %}

  <div class="alert alert-{{message.tags}} alert-dismissible fade show" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% endfor %}
  {% endif %}

  <div class="row">
    <div class="col">
      <hr>
      <h2 class="logo-font mb-4">My Profile</h2>
      <hr>
    </div>
  </div>

  <div class="row">
    <!-- <div class="row p-0 m-0 w-100"> -->
    <p class="w-100 m-2 p-0">
      <button class="btn btn-light w-100 shadow" type="button" data-bs-toggle="collapse"
        data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
        Register shipping information
      </button>
    </p>
    <div class="collapse m-2 p-0" id="collapseExample">
      <div class="card card-body shadow">
        <form action="{% url 'register_address' %}" method="POST" class="form">
          {% csrf_token %}
          {% bootstrap_form register_contact_form layout='floating'%}
          <button class="btn btn-primary btn-sm w-100 mb-5 mt-3" type="submit">
            <i class="bi bi-plus-lg fs-5"></i>
          </button>
          <input type="hidden" name="redirect_url" value="{{ request.path }}">
        </form>
      </div>
    </div>
  </div>

  {% if registered_contacts %}
  <div class="row">
    {% for registered_contact in registered_contacts %}
    <div class="card shadow-lg  bg-white rounded-3 ms-2 me-2 p-0" style="width: 18rem;">
      <!--Update Shipping Info-->
      <form action="{% url 'update_contact' registered_contact.item.pk %}" method="POST" class="form">
        {% csrf_token %}
        <div class="card-header">
          <h5 class>{{ registered_contact.item.name}}</h5>
          
        </div>
        <div class="card-body">
          {% bootstrap_field registered_contact.form.phone_number  layout='floating' %}
          {% bootstrap_field registered_contact.form.address  layout='floating'%}
          {% bootstrap_field registered_contact.form.city  layout='floating'%}
          {% bootstrap_field registered_contact.form.county  layout='floating'%}
          {% bootstrap_field registered_contact.form.postcode  layout='floating'%}
          {% bootstrap_field registered_contact.form.country  layout='floating'%}
        </div>
        <button class="btn btn-primary btn-sm w-100" type="submit">
          Update
        </button>
        <input type="hidden" name="redirect_url" value="{{ request.path }}">
      </form>

      <!--Delete Shipping Info-->
      <form action="{% url 'delete_contact'  registered_contact.item.pk %}" method="POST" class="form">
        {% csrf_token %}
        <button class="btn btn-danger btn-sm w-100" type="submit">
          Delete
        </button>
        <input type="hidden" name="redirect_url" value="{{ request.path }}">
      </form>




    </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="row">
    <div class="col">
      <hr>
      <h2 class="logo-font mb-4"> Order History</h2>
      <hr>
    </div>
  </div>

  <div class="row">
    <div class="accordion" id="accordionOrders">
      {% for order in orders %}

      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{order.order_number}}">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{order.order_number}}" aria-expanded="true" aria-controls="collapse{{order.order_number}}">
            <div class="col-4">
              #{{order.order_number}}
            </div>
            <div class="col-4">
              {{order.status}}
            </div>

            <div class="col-4">
              {{order.created_at}}
            </div>
          </button>
        </h2>
        <div id="collapse{{order.order_number}}" class="accordion-collapse collapse show" aria-labelledby="heading{{order.order_number}}" data-bs-parent="#accordionOrders">
          <div class="accordion-body">
            Delivery address: bla bla
            <hr>
            Notes: {{order.notes}}
          </div>
        </div>
      </div>

      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}